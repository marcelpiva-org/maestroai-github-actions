#!/usr/bin/env bash
set -euo pipefail

# Enforce Conventional Commits on commit messages
MSG_FILE="$1"
MSG=$(head -n1 "$MSG_FILE")

# Allowed types
TYPES="build|ci|chore|docs|feat|fix|perf|refactor|revert|style|test"

# Conventional commit regex (simple)
REGEX="^(${TYPES})(\([a-z0-9_.-]+\))?(!)?:[[:space:]].+"

if [[ "$MSG" =~ ^Merge\ .* ]]; then
  exit 0
fi

if [[ ! "$MSG" =~ $REGEX ]]; then
  echo "\nCommit message must follow Conventional Commits:" >&2
  echo "  <type>(<scope>)?: <subject>" >&2
  echo "Allowed types: ${TYPES}" >&2
  echo "Example: feat(cli): add chat command" >&2
  exit 1
fi

exit 0
